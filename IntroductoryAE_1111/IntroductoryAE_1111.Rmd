---
title: "應用計量經濟學導論"
subtitle: "實習課"
author: |
  <div style="margin-top:-18px; line-height:1.2;">
    <span style="font-weight:700;">王俊欽</span><br/>
    <span style="font-weight:700;">d14627001@ntu.edu.tw</span><br/>
    <span style="font-weight:700;">臺灣大學農業經濟研究所, 統計碩士學位學程</span><br/>
    <span style="font-weight:700;">2025/11/11</span><br/>
    &nbsp;
  </div>
output:
  xaringan::moon_reader:
    self_contained: true
    css: xaringan-themer.css
    #css: [xaringan-themer.css, zh-CN.css]
    #lib_dir: libs
    nature:
      highlightStyle: github
      highlightLanguage: ["r", "css", "yaml"]
      highlightLines: true
      countIncrementalSlides: false
---
```{r}

```

layout: true
background-image: url(https://www.agec.ntu.edu.tw/uploads/asset/data/675f864c74ccc38a768f8254/%E6%9C%AA%E4%BE%86%E5%B1%95%E6%9C%9B%E5%9C%96%E7%89%87.png)
background-position: 98% 2%
background-size: 5%

```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
library(vistributions)
library(gginference)
library(dplyr)
library(ggplot2)
setwd(dirname(rstudioapi::documentPath()))
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = TRUE, tidy = FALSE)
xaringanExtra::use_panelset()
xaringanExtra::use_clipboard()
xaringanExtra::use_extra_styles(hover_code_line = TRUE)
```
```{r xaringanExtra, echo = FALSE}
xaringanExtra::use_progress_bar(color = "#EFBE43", location = "bottom")
```
```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo(
  # colors
  primary_color = "#FDF7E9",
  secondary_color = "#EFBE43",
  header_color = "#333333",
  text_color = "#333333",
  code_inline_color = colorspace::lighten("#333333"),
  text_bold_color = colorspace::lighten("#333333"),
  link_color = "#4466B0",
  title_slide_text_color = "#4466B0",

  # fonts
  header_font_google = google_font("Martel", "300", "400"),
  text_font_google = google_font("Lato"),
  code_font_google = google_font("Fira Mono")
)

style_extra_css(
  # 只針對段落 (p) 和列表 (li) 內的 `code`
  list(
    "p code, li code" = list(  
      "border" = "1px solid #F6DB96",
      "padding" = "2px 4px",
      "border-radius" = "4px"
      ),
    "ul ul" = list(
      "list-style-type" = "'▸'"  # 第二層使用三角形 (▸)
      ),
    "ul ul ul" = list(
      "list-style-type" = "'✔'"  # 第三層使用勾勾 (✔)
      ),
    # 置中
    ".middle_block" = list(
      "position" = "absolute",
      "top" = "50%",
      "left" = "50%", # 使與預設靠左距離相同
      "transform" = "translate(-50%, -50%)",
      "width" = "85%",              # 控制內文寬度（可調整）
      "text-align" = "left"         
      ),
    # 縮排
    ".indent" = list(
      "text-indent" = "2em"
      ),
    # 自動換行
    "pre code" = list(
      "white-space" = "pre-wrap",
      "word-wrap" = "break-word"
      ),
    "pre" = list(
      "border" = "none",
      "box-shadow" = "2px 2px 2px 2px #F7EEDA",
      "padding" = "0.1em",
      "background" = "none !important",
      "overflow-x" = "auto",
      "border-radius" = "1px"
      ),
    # 條列圖示顏色
    "li::marker" = list(
      "content" = "• ",
      "color" =  "#EFBE43"
      )
    )
  )

```


```{r, echo = FALSE}
options(servr.daemon = TRUE)
```



---
class: center, middle, inverse

### more practice !

---
# Pokémon

.panelset[
.panel[.panel-name[question]
#### 進行資料分析前必要的前置動作

- `library` 你需要使用的套件（packages）

- 讀取分析需要用的檔案！

- 試著讀取 **Main.csv**，並且快速瀏覽資料。
]

.panel[.panel-name[answer]
#### 進行資料分析前必要的前置動作

- `library` 你需要使用的套件（packages）

- 讀取分析需要用的檔案！
```{r eval = F}
setwd("your working directory") # if necessary
```
```{r}
main <- read.csv("./Main.csv")
glimpse(main)
```
]


]

---
# Pokémon
.panelset[
.panel[.panel-name[question]
#### 將 main 與 info 合併，請問 df 資料中共有哪些 region？ 
]

.panel[.panel-name[answer1]
#### 將 main 與 info 合併，請問 df 資料中共有哪些 region？ 
```{r}
info <- read.csv("./Info.csv")
df <- main %>% left_join(info, by = "generation_id")
unique(df$region)[!is.na(unique(df$region))]
```
]

.panel[.panel-name[answer2]
#### 先將 main 與 info 合併，請問 df 資料中共有哪些 region？  
```{r}
library(tidyr)
df %>% select(region) %>% distinct() %>% drop_na()
```
]

]

---
# Pokémon
.panelset[
.panel[.panel-name[question]
#### 篩選出 base_experience 比 pikachu 多，且 type_1 屬於 electric 的樣本。
]

.panel[.panel-name[answer1]
#### 篩選出 base_experience 比 pikachu 多，且 type_1 屬於 electric 的樣本。

```{r eval = F}
pika <- df %>% filter(pokemon == "pikachu") %>% pull(base_experience)
df %>% filter(base_experience > pika & type_1 == "electric") 
```

** 這裡為什麼用 pull 而不是 select？**
]

.panel[.panel-name[answer2]
#### 篩選出 base_experience 比 pikachu 多，且 type_1 屬於 electric 的樣本。

```{r eval = F}
df %>% filter(base_experience > df %>% filter(pokemon == "pikachu") %>% pull(base_experience) & type_1 == "electric") 
```
]

.panel[.panel-name[answer3]
#### 篩選出 base_experience 比 pikachu 多，且 type_1 屬於	electric 的樣本。

```{r eval = F}
df %>% filter(base_experience > df[df$pokemon == "pikachu", "base_experience"] & type_1 == "electric") 
```
]
]

---
# Pokémon

.panelset[
.panel[.panel-name[question]
#### 新增一變數 is_generationY 表示寶可夢是不是千禧年（before year 1997）前才出現，如果 release_year 小於 1997 則為 1，不是則為 0。 
]

.panel[.panel-name[answer1]
#### 新增一變數 is_generationY 表示寶可夢是不是千禧年（before year 1997）前才出現，如果 release_year 小於 1997 則為 1，不是則為 0。 
```{r eval = F}
df %>% mutate(is_generationY = if_else(release_year < 1997, 1, 0))
```
]

.panel[.panel-name[answer2]
#### 新增一變數 is_generationY 表示寶可夢是不是千禧年（before year 1997）前才出現，如果 release_year 小於 1997 則為 1，不是則為 0。  
```{r eval = F}
df$is_generationY <- if_else(df$release_year < 1997, 1, 0)
```
]

]

---
# Pokémon 
.panelset[
.panel[.panel-name[question]
#### 根據 type_1 分類，每種分類寶可夢的平均 hp 是多少？
]
.panel[.panel-name[answer1]
#### 根據 type_1 分類，每種分類寶可夢的平均 hp 是多少？
```{r}
df %>% group_by(type_1) %>% summarize(mean_hp = mean(hp, na.rm = T))
```
]
]

---
# Pokémon 
.panelset[
.panel[.panel-name[question]
#### 承上題，哪種屬性的寶可夢平均生命值最低？並舉例五隻該屬性的寶可夢。
]
.panel[.panel-name[answer1]
#### 承上題，哪種屬性的寶可夢平均生命值最低？並舉例五隻該屬性的寶可夢。
```{r}
light_type <- df %>% group_by(type_1) %>%
  summarize(mean_hp = mean(hp, na.rm = T)) %>%
  arrange(mean_hp) %>% slice(1) %>% pull(type_1)

df %>% filter(type_1 == light_type) %>% select(pokemon) %>% slice(1:5)
```

]

.panel[.panel-name[answer2]
#### 承上題，哪種屬性的寶可夢平均生命值最低？並舉例五隻該屬性的寶可夢。
```{r}
poke_hp <- df %>% group_by(type_1) %>%
  summarize(mean_hp = mean(hp, na.rm = T)) %>%
  arrange(mean_hp) %>% pull(type_1) %>% .[1]

set.seed(1111)
df %>% filter(type_1 == light_type) %>% pull(pokemon) %>% sample(5)
```

** . 可以當作一個 argument 放進 pipeline 中。**
]

.panel[.panel-name[common error]
#### 承上題，哪種屬性的寶可夢平均生命值最低？並舉例五隻該屬性的寶可夢。
```{r}
poke_hp <- df %>% group_by(type_1) %>% summarize(mean_hp = mean(hp, na.rm = T))
light_type <- poke_hp %>% arrange(mean_hp) %>% select(type_1) %>% slice(1)
class(light_type)
```

#### 這時候，light_type 是一個只有 1 row、1 column 的 data frame，而不是一個 character。

```{r}
df %>% filter(type_1 == light_type)
```
]
]


---
# Pokémon 

.panelset[
.panel[.panel-name[question]
#### 繪製各 generation 寶可夢數量長條圖 

]

.panel[.panel-name[answer1]
#### 繪製各 generation 寶可夢數量長條圖 

```{r out.width='45%', fig.align='center'}
library(tidyr)
df %>% group_by(generation_id) %>% summarise(count = n()) %>% drop_na() %>% 
  ggplot(aes(x = generation_id, y = count)) + geom_col() + theme_minimal()
```
]

.panel[.panel-name[answer2]
#### 繪製各 generation 寶可夢數量長條圖 

```{r out.width='40%', fig.align='center'}
df %>% count(generation_id) %>% drop_na() %>% 
  ggplot(aes(x = generation_id, y = n, fill = factor(generation_id))) + 
  geom_col() + theme_minimal()
```
]

- ** count 在計數時可以取代 group_by 與 summarize （只有在計數而已）。**

- ** 記得有面積的圖形，填色是 fill 而不是 color 。**
]

<!-- --- -->
<!-- # Pokémon -->
<!-- #### 也可以把圖片當作散布圖來畫 -->
<!-- ```{r warning = F, out.width='30%', fig.align='center'} -->
<!-- library(ggimage) -->
<!-- df %>% filter(type_1 == "flying") %>% select(pokemon, attack, defense, url_image) %>% -->
<!--   ggplot(aes(x = attack, y = defense)) + geom_image(aes(image = url_image), size = 0.1) -->
<!-- ``` -->

---
class: center, middle, inverse
### 謝謝
#### 下周見